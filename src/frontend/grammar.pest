WHITESPACE = _{ " " | "\t" | NEWLINE }

COMMENT = _{ ("//" ~ (!NEWLINE ~ ANY)* ~ NEWLINE) | "/*" ~ (!"*/" ~ ANY)* ~ "*/" }

sep = _{ "_" | "-"}

identifier = @{ ASCII_ALPHA+ ~ (sep | ASCII_ALPHA | ASCII_DIGIT)* }

number = @{ ASCII_DIGIT+ }

int = @{ ASCII_ALPHA_LOWER ~ ASCII_DIGIT+ }

bool = @{ ASCII_ALPHA_LOWER+ }

ty = { int | bool }

expr = { identifier | number }

primop = { "reg" | "add" | "sub" | "mul" }

stdop = { "id" }

op = _{ primop | stdop }

attrs = { "[" ~ (expr ~ ("," ~ expr)*)? ~ "]" }

params = { "(" ~ (expr ~ ("," ~ expr)*)? ~ ")" }

instr = { identifier ~ ":" ~ ty ~ "=" ~ op ~ attrs? ~ params ~ ";" }

instrs = { instr ~ (instr)* }

input = { identifier ~ ":" ~ ty }

inputs = { "(" ~ (input ~ ("," ~ input)*)? ~ ")" }

output = { identifier ~ ":" ~ ty }

outputs = { "->" ~ "(" ~ (output ~ ("," ~ output)*)? ~ ")" }

def = {
    "def" ~ identifier ~ inputs ~ outputs ~ "{" ~ instrs ~ "}"
}

file = { SOI ~ def+ ~ EOI }